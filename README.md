# Casestudy_BMW_Business_reporting

Guide for utilizing this project repository

# Project Setup Guide (Using PDM)

This project uses PDM as the package and environment manager.
Follow the steps below to prepare your development environment after cloning the repository.
### Note: Do not manually modify `pdm.lock`. It is auto-generated and manual editing may cause it and the environment to break
  
  
  
## 1. Install PDM (if you don’t already have it)

PDM requires Python 3.8+.

```bash
pip install pdm
```

Or install via pipx:

```bash
pipx install pdm
```

Verify installation:

```bash
pdm --version
```
  
  
## 2. Clone the Repository

```bash
git clone <repo-url>
cd <project-folder>
```
  

## 3. Initialize the PDM Environment

PDM automatically reads `pyproject.toml` and prepares a virtual environment.

Install all dependencies:

```bash
pdm install
```

This will:

- Create a virtual environment (if one doesn’t already exist)
- Install project dependencies
  
  
## 4. Activate the Project Environment

PDM automatically manages virtual environments.
To activate the shell inside the environment:

```bash
pdm venv activate
```

Alternatively, run commands inside the environment without activating it:

Example:
```bash
pdm run pytest
pdm run kedro info
```

*Note: `pdm run` works regardless of whether the virtual environment was activated, 
so examples in this readme will continue to use that. If you have your virtual environment setup,
you may leave out `pdm run` 
  
  
## 5. Create .env file

LLMs called when executing the `__default__` and `invoke_llm_only` pipelines require environmental variables.
Create a `.env` file in the project directory with these variables:

```.env
GEMINI_API_KEY=<your-api-key>
GEMINI_MODEL="gemini-2.5-flash"
```

you may use other gemini models but the project was tested with `gemini-2.5-flash`.
  
  
## 6. Test if `kedro` works

```bash
pdm run kedro info
```
If you see ASCII art of KEDRO, your environment is setup.
  
  
## 7. Input data
Input the data to make a report of, into `data/01_raw`. Ensure the data is composed of only one `.xlsx` file 
and ensure there is no other `.xlsx` file in the folder.
  
  
## 8. Run the pipeline
To run the full pipeline:

```bash
pdm run kedro run
```

Alternatively, you may run each pipeline individually. They must be run in sequence.

```bash
pdm run kedro run -p data_preprocessing_only
pdm run kedro run -p invoke_llm_only
pdm run kedro run -p generate_report_only
```
  

## 9. In case there is an error during report generation
  
Check if the error is caused by failed execution of a "python-snippet" generated by the llm. (Likely manifestation is failure to index a dataframe)
If so, the llm output will need to be regenerated. Run:
  
```bash
pdm run kedro run -p invoke_llm_only
pdm run kedro run -p generate_report_only
```
  

## 10. Running for more than one set of data

Before running a second set of data, please manually archive all generated artefacts into `data/03_archived` as you see fit. Leave the `.gitkeep` be.
(Apologies, I did not have time to automate that) Remove the first set of data from `data/01_raw` such that the second `.xlsx` file 
is the only `.xlsx` file in `data/01_raw``.
